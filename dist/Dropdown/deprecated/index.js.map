{"version":3,"sources":["../../../src/Dropdown/deprecated/index.jsx"],"names":["React","PropTypes","classNames","DropdownButton","DropdownMenu","DropdownItem","withDeprecatedProps","DEPR_TYPES","createContext","Provider","Consumer","Dropdown","props","e","containerRef","current","contains","target","state","open","close","key","preventDefault","focusPrevious","focusNext","shiftKey","stopPropagation","uniqueId","idCounter","triggerId","createRef","menuRef","buttonRef","prevProps","prevState","focusFirst","focus","document","removeEventListener","handleDocumentClick","selector","Array","from","querySelectorAll","setState","addEventListener","focusableElements","getFocusableElements","length","allFocusableElements","activeIndex","indexOf","activeElement","nextIndex","previousIndex","children","other","show","className","handleMenuKeyDown","isOpen","toggle","Component","propTypes","node","isRequired","Item","Button","Menu","DropdownWithDeprecatedProps","menuItems","deprType","MOVED_AND_FORMAT","message","newName","transform","allProps","isArray","isValidElement","iconElement","title","map","menuItem","i","cloneElement","href","label","REMOVED","buttonType","defaultProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\n// eslint-disable-next-line import/no-cycle\nimport DropdownButton from './DropdownButton';\n// eslint-disable-next-line import/no-cycle\nimport DropdownMenu from './DropdownMenu';\nimport DropdownItem from './DropdownItem';\n\nimport withDeprecatedProps, { DEPR_TYPES } from '../../withDeprecatedProps';\n\nconst { Provider, Consumer } = React.createContext();\n\nclass Dropdown extends React.Component {\n  // eslint-disable-next-line react/sort-comp\n  static idCounter = 0; // For creating unique ids\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      open: false,\n    };\n\n    // Used for aria labelling. Increment the id counter so the next id can be unique\n    this.uniqueId = Dropdown.idCounter;\n    Dropdown.idCounter += 1;\n    this.triggerId = `pgn__dropdown-trigger-${this.uniqueId}`;\n\n    this.containerRef = React.createRef();\n    this.menuRef = React.createRef();\n    this.buttonRef = React.createRef();\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevState.open !== this.state.open) {\n      if (this.state.open) {\n        this.focusFirst();\n      } else {\n        this.buttonRef.current.focus();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('click', this.handleDocumentClick, true);\n  }\n\n  getFocusableElements() {\n    const selector = 'button:not([disabled]), [href]:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"]):not([disabled])';\n    return Array.from(this.menuRef.current.querySelectorAll(selector));\n  }\n\n  handleDocumentClick = (e) => {\n    if (this.containerRef.current.contains(e.target) && this.containerRef.current !== e.target) {\n      return;\n    }\n    if (this.state.open) {\n      this.close();\n    }\n  }\n\n  handleMenuKeyDown = (e) => {\n    switch (e.key) {\n      case 'ArrowUp':\n        e.preventDefault();\n        this.focusPrevious();\n        break;\n      case 'ArrowDown':\n        e.preventDefault();\n        this.focusNext();\n        break;\n      case 'Tab':\n        e.preventDefault();\n        if (e.shiftKey) {\n          this.focusPrevious();\n        } else {\n          this.focusNext();\n        }\n        break;\n      case 'Escape':\n        e.stopPropagation();\n        this.close();\n        break;\n      default:\n        break;\n    }\n  }\n\n  toggle = () => {\n    if (this.state.open) {\n      this.close();\n    } else {\n      this.open();\n    }\n  }\n\n  close() {\n    document.removeEventListener('click', this.handleDocumentClick, true);\n    this.setState({\n      open: false,\n    });\n  }\n\n  open() {\n    // adding event listener here so the user can close dropdown on click outside of the dropdown\n    document.addEventListener('click', this.handleDocumentClick, true);\n    this.setState({\n      open: true,\n    });\n  }\n\n  focusFirst() {\n    const focusableElements = this.getFocusableElements();\n    if (focusableElements.length) { focusableElements[0].focus(); }\n  }\n\n  focusNext() {\n    const allFocusableElements = this.getFocusableElements();\n    if (allFocusableElements.length === 0) { return; }\n    const activeIndex = allFocusableElements.indexOf(document.activeElement);\n    const nextIndex = (activeIndex + 1) % allFocusableElements.length;\n    allFocusableElements[nextIndex].focus();\n  }\n\n  focusPrevious() {\n    const allFocusableElements = this.getFocusableElements();\n    if (allFocusableElements.length === 0) { return; }\n    const activeIndex = allFocusableElements.indexOf(document.activeElement);\n    const previousIndex = ((activeIndex - 1) + allFocusableElements.length) % allFocusableElements.length;\n    allFocusableElements[previousIndex].focus();\n  }\n\n  render() {\n    const { children, ...other } = this.props;\n\n    return (\n      <div\n        {...other}\n        className={classNames(\n          'dropdown',\n          { show: this.state.open },\n          other.className,\n        )}\n        ref={this.containerRef}\n      >\n        <Provider\n          value={{\n            buttonRef: this.buttonRef,\n            handleMenuKeyDown: this.handleMenuKeyDown,\n            isOpen: this.state.open,\n            menuRef: this.menuRef,\n            toggle: this.toggle,\n            triggerId: this.triggerId,\n          }}\n        >\n          {children}\n        </Provider>\n      </div>\n    );\n  }\n}\n\nDropdown.propTypes = {\n  children: PropTypes.node.isRequired,\n};\n\nDropdown.Item = DropdownItem;\nDropdown.Button = DropdownButton;\nDropdown.Menu = DropdownMenu;\n\nconst DropdownWithDeprecatedProps = withDeprecatedProps(Dropdown, 'Dropdown', {\n  menuItems: {\n    deprType: DEPR_TYPES.MOVED_AND_FORMAT,\n    message: 'They should be components sent as children.',\n    newName: 'children',\n    transform: (menuItems, allProps) => {\n      if (!Array.isArray(menuItems)) { return null; }\n      return (\n        <>\n          <DropdownButton>\n            {React.isValidElement(allProps.iconElement) ? allProps.iconElement : null }\n            {allProps.title}\n          </DropdownButton>\n          <DropdownMenu>\n            {menuItems.map((menuItem, i) => {\n            /* eslint-disable react/no-array-index-key */\n              if (React.isValidElement(menuItem)) {\n                return React.cloneElement(menuItem, {\n                  className: 'dropdown-item',\n                  key: i,\n                });\n              }\n              return <DropdownItem key={i} href={menuItem.href}>{menuItem.label}</DropdownItem>;\n            /* eslint-enable react/no-array-index-key */\n            })}\n          </DropdownMenu>\n        </>\n      );\n    },\n  },\n  title: {\n    deprType: DEPR_TYPES.REMOVED,\n    message: 'It should be specified inside the Dropdown.Button component',\n  },\n  buttonType: {\n    deprType: DEPR_TYPES.REMOVED,\n    message: 'It should be specified as a className prop',\n  },\n  iconElement: {\n    deprType: DEPR_TYPES.REMOVED,\n    message: 'It should be specified inside the buttonContent prop.',\n  },\n});\n\nDropdownWithDeprecatedProps.propTypes = Dropdown.propTypes;\nDropdownWithDeprecatedProps.defaultProps = Dropdown.defaultProps;\nDropdownWithDeprecatedProps.Item = Dropdown.Item;\nDropdownWithDeprecatedProps.Button = Dropdown.Button;\nDropdownWithDeprecatedProps.Menu = Dropdown.Menu;\n\nexport { Provider, Consumer };\nexport default DropdownWithDeprecatedProps;\n"],"file":"index.js"}